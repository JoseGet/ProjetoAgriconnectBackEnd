generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model associacao {
  id_associacao String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome          String
  descricao     String
  vendedor      vendedor[]
}

model atende_um {
  id_pedido   Int
  id_vendedor String   @db.Uuid
  pedido      pedido   @relation(fields: [id_pedido], references: [pedido_id], onDelete: NoAction, onUpdate: NoAction)
  vendedor    vendedor @relation(fields: [id_vendedor], references: [id_vendedor], onDelete: NoAction, onUpdate: NoAction)

  @@id([id_pedido, id_vendedor])
}

model cliente {
  cpf      String   @id @db.VarChar(11)
  nome     String
  email    String   @unique
  telefone String   @db.VarChar(11)
  senha    String   @db.VarChar(100)
  pedido   pedido[]
  favoritos favorita_um[]
}

model feira {
  id_feira Int      @id @default(autoincrement())
  nome     String
  endereco String
  pedido   pedido[]
}

model pedido {
  pedido_id   Int         @id @default(autoincrement())
  data_pedido DateTime    @default(dbgenerated("CURRENT_DATE")) @db.Date
  fk_feira    Int?
  fk_cliente  String      @db.VarChar(11)
  atende_um   atende_um[]
  cliente     cliente     @relation(fields: [fk_cliente], references: [cpf], onDelete: NoAction, onUpdate: NoAction, map: "fk_cliente")
  feira       feira?      @relation(fields: [fk_feira], references: [id_feira], onDelete: NoAction, onUpdate: NoAction, map: "fk_feira")
  produtos_no_pedido item_pedido[]
}

model categoria {
  id_categoria String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome         String
  produto      produto[]
}

model produto {
  id_produto     String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  nome           String
  descricao      String
  image          String
  is_promocao    Boolean
  preco          Float
  preco_promocao Float?
  fk_vendedor    String    @db.Uuid
  id_categoria   String    @db.Uuid
  disponivel     Boolean
  vendedor       vendedor  @relation(fields: [fk_vendedor], references: [id_vendedor], onDelete: NoAction, onUpdate: NoAction, map: "fk_vendedor")
  categoria      categoria @relation(fields: [id_categoria], references: [id_categoria])
  favoritado_por   favorita_um[]
  itens_em_pedidos item_pedido[]
}

model vendedor {
  nome             String
  telefone         String         @db.VarChar(15)
  endereco_venda   String
  tipo_vendedor    tipo_vendedor
  tipo_documento   tipo_documento
  numero_documento String
  id_vendedor      String         @id @db.Uuid
  fk_associacao    String?        @db.Uuid
  senha            String         @db.VarChar(100)
  atende_um        atende_um[]
  produto          produto[]
  associacao       associacao?    @relation(fields: [fk_associacao], references: [id_associacao], onDelete: NoAction, onUpdate: NoAction, map: "fk_associacao")
}

model item_pedido {
  id_item_pedido String @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  quantidade Int

  pedido_id Int
  produto_id String @db.Uuid

  produto produto @relation(fields: [produto_id], references: [id_produto])
  pedido pedido @relation(fields: [pedido_id], references: [pedido_id])
}

model favorita_um {
  id_favorito       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cliente           cliente  @relation(fields: [cliente_cpf], references: [cpf])
  cliente_cpf       String   @db.VarChar(11)
  produto           produto  @relation(fields: [produto_id], references: [id_produto])
  produto_id        String   @db.Uuid

  @@unique([cliente_cpf, produto_id])
}

enum tipo_documento {
  CPF
  CNPJ
}

enum tipo_vendedor {
  PF
  PJ
}
